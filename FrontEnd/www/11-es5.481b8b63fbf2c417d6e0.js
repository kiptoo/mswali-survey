!function(){function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],n=!0,i=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(o.push(s.value),!t||o.length!==t);n=!0);}catch(u){i=!0,r=u}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}return o}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=o(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw s}}}}function o(e,t){if(e){if("string"==typeof e)return n(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"+s8L":function(o,n,s){"use strict";s.r(n),s.d(n,"EditSurveyPageModule",(function(){return J}));var a=s("ofXK"),u=s("3Pt+"),c=s("TEn/"),b=s("tyNb"),l=s("mrSG"),d=s("EnSQ"),p=s("fXoL");function v(e,t){if(1&e){var o=p.Lb();p.Kb(0,"div",25),p.Kb(1,"ion-button",2),p.Rb("click",(function(){p.dc(o);var e=t.index,n=p.Tb().$implicit;return p.Tb().removeOption(n,e)})),p.Ib(2,"ion-icon",26),p.Jb(),p.Kb(3,"ion-label"),p.hc(4,"Option Text"),p.Jb(),p.Kb(5,"ion-item"),p.Ib(6,"ion-input",27),p.Jb(),p.Jb()}2&e&&p.Yb("formGroupName",t.index)}function m(e,t){if(1&e){var o=p.Lb();p.Kb(0,"div",17),p.Kb(1,"ion-button",2),p.Rb("click",(function(){p.dc(o);var e=t.index;return p.Tb().removeQuestion(e)})),p.Ib(2,"ion-icon",18),p.Jb(),p.Kb(3,"ion-label"),p.hc(4,"Question name"),p.Jb(),p.Kb(5,"ion-item"),p.Ib(6,"ion-input",19),p.Jb(),p.Kb(7,"ion-label"),p.hc(8,"Question Title"),p.Jb(),p.Kb(9,"ion-item"),p.Ib(10,"ion-input",11),p.Jb(),p.Kb(11,"ion-label"),p.hc(12,"Question type"),p.Jb(),p.Kb(13,"ion-item"),p.Kb(14,"ion-select",20),p.Kb(15,"ion-select-option",21),p.hc(16,"dropdown"),p.Jb(),p.Kb(17,"ion-select-option",22),p.hc(18,"radio"),p.Jb(),p.Jb(),p.Jb(),p.Kb(19,"ion-button",2),p.Rb("click",(function(){p.dc(o);var e=t.$implicit;return p.Tb().addOption(e)})),p.hc(20," Add Option "),p.Ib(21,"ion-icon",13),p.Jb(),p.Kb(22,"div",23),p.gc(23,v,7,1,"div",24),p.Jb(),p.Jb()}if(2&e){var n=t.$implicit;p.Yb("formGroupName",t.index),p.xb(23),p.Yb("ngForOf",n.get("options").controls)}}var f,h,y,g=[{path:"",component:(f=function(){function o(e,t,n,r,s,a){var u=this;i(this,o),this.dataService=e,this.router=t,this.fb=n,this.activatedRoute=r,this.modalController=s,this.routerOutlet=a,this.questionsInit=!1,this.newSurveyForm={title:"",description:""},this.dynamicForm={email:"",name:"",phone:"",response:[]},this.surveys=[{_id:34},{_id:35},{_id:36},{_id:37}],this.currentUser=JSON.parse(localStorage.getItem("mswalitoken"));var c=this.currentUser.email.split("@");this.username=c[0],this.activatedRoute.queryParams.subscribe((function(e){u.surveyId=u.activatedRoute.snapshot.params.id}))}var n,s,a;return n=o,(s=[{key:"ngOnInit",value:function(){var e=this;this.SurveyForm=this.fb.group({survey_details:this.fb.group({_id:"",title:"",description:""}),questions:this.fb.array([])}),this.dataService.getsurveyById(this.surveyId).subscribe((function(t){e.loadForm(t),e.survey=t}))}},{key:"addQuestion",value:function(){this.SurveyForm.get("questions").push(this.questions)}},{key:"removeQuestion",value:function(e){this.SurveyForm.get("questions").removeAt(e)}},{key:"addOption",value:function(e){e.get("options").push(this.options)}},{key:"removeOption",value:function(e,t){e.get("options").removeAt(t)}},{key:"loadForm",value:function(e){this.SurveyForm.controls.survey_details.controls._id.patchValue(e._id),this.SurveyForm.controls.survey_details.controls.title.patchValue(e.title),this.SurveyForm.controls.survey_details.controls.description.patchValue(e.description);for(var t=0;t<e.questions.length;t++){var o=this.SurveyForm.get("questions");o.push(this.questions);for(var n=0;n<e.questions[t].options.length;n++)o.at(t).get("options").push(this.options)}this.SurveyForm.patchValue(e)}},{key:"onSubmit",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function o(){var n,i,r,s,a,u,c,b,l,d,p,v,m,f,h,y,g,S,J;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(n=this.SurveyForm.value,console.log("form data",n),!this.SurveyForm.get("questions").touched){o.next=34;break}console.log("toched"),i=n.questions,r=t(i.entries()),o.prev=5,r.s();case 7:if((s=r.n()).done){o.next=26;break}if(a=e(s.value,2),u=a[0],c=a[1],b=this.SurveyForm.get("questions"),l=b.at(u).get("options"),!b.at(u).touched){o.next=24;break}if(c.survey_id=n.survey_details._id,!c._id){o.next=16;break}d=c,this.dataService.updateQuestion(d).subscribe(),console.log("Update question",d),o.next=21;break;case 16:return p=c,o.next=19,this.dataService.createQuestion(p).toPromise();case 19:this.createdQuestion=o.sent,console.log("Create new question this.createdQuestion",this.createdQuestion);case 21:v=c.options,m=t(v.entries());try{for(m.s();!(f=m.n()).done;)h=e(f.value,2),y=h[0],g=h[1],l.at(y).touched&&(g.question_id=c._id,g._id?(this.dataService.updateOption(g).subscribe(),console.log("update new option",g)):(g.question_id=this.createdQuestion._id,this.dataService.createOption(g).subscribe(),console.log("Create new option",g)))}catch(K){m.e(K)}finally{m.f()}case 24:o.next=7;break;case 26:o.next=31;break;case 28:o.prev=28,o.t0=o.catch(5),r.e(o.t0);case 31:return o.prev=31,r.f(),o.finish(31);case 34:this.SurveyForm.get("survey_details").touched&&(n.survey_details._id?(S=n.survey_details,this.dataService.updateSurvey(S).subscribe(),console.log("Create new survey",S)):(J=n.survey_details,this.dataService.createSurvey(J).subscribe(),console.log("Create new survey",J)));case 35:case"end":return o.stop()}}),o,this,[[5,28,31,34]])})))}},{key:"createSurvey",value:function(){var e=this;console.log("this.newSurveyForm",this.newSurveyForm),this.dataService.createSurvey(this.newSurveyForm).subscribe((function(t){console.log("submitSurvey resp",t),e.surveyId=t._id,e.newSurveyForm={title:t.title,description:t.description}}))}},{key:"logout",value:function(){this.dataService.logout().subscribe((function(e){console.log("logged out",e)}))}},{key:"questions",get:function(){return this.fb.group({_id:"",title:"",name:"",type:"",options:this.fb.array([])})}},{key:"options",get:function(){return this.fb.group({_id:"",value:""})}}])&&r(n.prototype,s),a&&r(n,a),o}(),f.\u0275fac=function(e){return new(e||f)(p.Hb(d.a),p.Hb(b.g),p.Hb(u.c),p.Hb(b.a),p.Hb(c.H),p.Hb(c.x))},f.\u0275cmp=p.Bb({type:f,selectors:[["app-edit-survey"]],decls:42,vars:5,consts:[["slot","primary"],["src","../../assets/avatar.svg"],[3,"click"],["size","large","name","log-out-sharp"],[1,"ion-padding"],[1,"ion-margin","ion-padding"],[1,"ion-margin"],["size","12"],[1,"favCard-header"],[3,"formGroup","ngSubmit"],["formGroupName","survey_details",1,"form-header"],["type","text","formControlName","title","name","title"],["type","text","formControlName","description","name","description"],["size","large","name","add-circle-outline",1,"ion-padding"],["formArrayName","questions"],["class","questions",3,"formGroupName",4,"ngFor","ngForOf"],["color","primary","type","submit"],[1,"questions",3,"formGroupName"],["size","large","name","close-circle-outline"],["type","text","formControlName","name","name","title"],["formControlName","type","placeholder","Select One"],["value","dropdown"],["value","radio"],["formArrayName","options"],["class","options",3,"formGroupName",4,"ngFor","ngForOf"],[1,"options",3,"formGroupName"],["name","close-circle-outline"],["type","text","formControlName","value","name","value"]],template:function(e,t){1&e&&(p.Kb(0,"ion-header"),p.Kb(1,"ion-toolbar"),p.Kb(2,"ion-buttons",0),p.Kb(3,"ion-chip"),p.Kb(4,"ion-avatar"),p.Ib(5,"img",1),p.Jb(),p.Kb(6,"ion-label"),p.hc(7),p.Jb(),p.Jb(),p.Kb(8,"ion-button",2),p.Rb("click",(function(){return t.logout()})),p.Ib(9,"ion-icon",3),p.Jb(),p.Jb(),p.Kb(10,"ion-title"),p.hc(11,"Mswali Test Survey"),p.Jb(),p.Jb(),p.Jb(),p.Kb(12,"ion-content",4),p.Kb(13,"h1",5),p.hc(14,"Edit Survey"),p.Jb(),p.Kb(15,"ion-content",6),p.Kb(16,"ion-row"),p.Kb(17,"ion-col",7),p.Kb(18,"ion-card",4),p.Kb(19,"ion-card-header",8),p.Kb(20,"ion-card-title"),p.hc(21),p.Jb(),p.Kb(22,"ion-card-subtitle"),p.hc(23),p.Jb(),p.Jb(),p.Kb(24,"ion-card-content"),p.Kb(25,"form",9),p.Rb("ngSubmit",(function(){return t.onSubmit()})),p.Kb(26,"div",10),p.Kb(27,"ion-label"),p.hc(28,"Survey Title"),p.Jb(),p.Kb(29,"ion-item"),p.Ib(30,"ion-input",11),p.Jb(),p.Kb(31,"ion-label"),p.hc(32,"Description"),p.Jb(),p.Kb(33,"ion-item"),p.Ib(34,"textarea",12),p.Jb(),p.Jb(),p.Kb(35,"ion-button",2),p.Rb("click",(function(){return t.addQuestion()})),p.hc(36," Add Question "),p.Ib(37,"ion-icon",13),p.Jb(),p.Kb(38,"div",14),p.gc(39,m,24,2,"div",15),p.Jb(),p.Kb(40,"ion-button",16),p.hc(41,"Create"),p.Jb(),p.Jb(),p.Jb(),p.Jb(),p.Jb(),p.Jb(),p.Jb(),p.Jb()),2&e&&(p.xb(7),p.ic(t.username),p.xb(14),p.ic(null==t.survey?null:t.survey.description),p.xb(2),p.ic(null==t.survey?null:t.survey.description),p.xb(2),p.Yb("formGroup",t.SurveyForm),p.xb(14),p.Yb("ngForOf",t.SurveyForm.get("questions").controls))},directives:[c.o,c.D,c.e,c.k,c.c,c.s,c.d,c.p,c.C,c.m,c.y,c.l,c.f,c.h,c.j,c.i,c.g,u.q,u.k,u.e,u.f,c.r,c.q,c.N,u.j,u.d,u.a,u.b,a.i,c.z,c.M,c.A],styles:[".questions[_ngcontent-%COMP%]{padding:10px;margin:10px 0;border:1px solid #000}.closebutton[_ngcontent-%COMP%]{margin-top:1px;margin-right:2px;position:absolute;top:0;right:0}"]}),f)}],S=((y=function e(){i(this,e)}).\u0275mod=p.Fb({type:y}),y.\u0275inj=p.Eb({factory:function(e){return new(e||y)},imports:[[b.k.forChild(g)],b.k]}),y),J=((h=function e(){i(this,e)}).\u0275mod=p.Fb({type:h}),h.\u0275inj=p.Eb({factory:function(e){return new(e||h)},imports:[[a.b,u.g,u.n,c.E,S]]}),h)}}])}();