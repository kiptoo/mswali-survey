(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"+s8L":function(e,t,o){"use strict";o.r(t),o.d(t,"EditSurveyPageModule",(function(){return m}));var i=o("ofXK"),n=o("3Pt+"),r=o("TEn/"),s=o("tyNb"),u=o("mrSG"),a=o("EnSQ"),c=o("fXoL");function b(e,t){if(1&e){const e=c.Lb();c.Kb(0,"div",25),c.Kb(1,"ion-button",2),c.Rb("click",(function(){c.dc(e);const o=t.index,i=c.Tb().$implicit;return c.Tb().removeOption(i,o)})),c.Ib(2,"ion-icon",26),c.Jb(),c.Kb(3,"ion-label"),c.hc(4,"Option Text"),c.Jb(),c.Kb(5,"ion-item"),c.Ib(6,"ion-input",27),c.Jb(),c.Jb()}2&e&&c.Yb("formGroupName",t.index)}function l(e,t){if(1&e){const e=c.Lb();c.Kb(0,"div",17),c.Kb(1,"ion-button",2),c.Rb("click",(function(){c.dc(e);const o=t.index;return c.Tb().removeQuestion(o)})),c.Ib(2,"ion-icon",18),c.Jb(),c.Kb(3,"ion-label"),c.hc(4,"Question name"),c.Jb(),c.Kb(5,"ion-item"),c.Ib(6,"ion-input",19),c.Jb(),c.Kb(7,"ion-label"),c.hc(8,"Question Title"),c.Jb(),c.Kb(9,"ion-item"),c.Ib(10,"ion-input",11),c.Jb(),c.Kb(11,"ion-label"),c.hc(12,"Question type"),c.Jb(),c.Kb(13,"ion-item"),c.Kb(14,"ion-select",20),c.Kb(15,"ion-select-option",21),c.hc(16,"dropdown"),c.Jb(),c.Kb(17,"ion-select-option",22),c.hc(18,"radio"),c.Jb(),c.Jb(),c.Jb(),c.Kb(19,"ion-button",2),c.Rb("click",(function(){c.dc(e);const o=t.$implicit;return c.Tb().addOption(o)})),c.hc(20," Add Option "),c.Ib(21,"ion-icon",13),c.Jb(),c.Kb(22,"div",23),c.gc(23,b,7,1,"div",24),c.Jb(),c.Jb()}if(2&e){const e=t.$implicit;c.Yb("formGroupName",t.index),c.xb(23),c.Yb("ngForOf",e.get("options").controls)}}const d=[{path:"",component:(()=>{class e{constructor(e,t,o,i,n,r){this.dataService=e,this.router=t,this.fb=o,this.activatedRoute=i,this.modalController=n,this.routerOutlet=r,this.questionsInit=!1,this.newSurveyForm={title:"",description:""},this.dynamicForm={email:"",name:"",phone:"",response:[]},this.surveys=[{_id:34},{_id:35},{_id:36},{_id:37}],this.currentUser=JSON.parse(localStorage.getItem("mswalitoken"));let s=this.currentUser.email.split("@");this.username=s[0],this.activatedRoute.queryParams.subscribe(e=>{this.surveyId=this.activatedRoute.snapshot.params.id})}ngOnInit(){this.SurveyForm=this.fb.group({survey_details:this.fb.group({_id:"",title:"",description:""}),questions:this.fb.array([])}),this.dataService.getsurveyById(this.surveyId).subscribe(e=>{this.loadForm(e),this.survey=e})}get questions(){return this.fb.group({_id:"",title:"",name:"",type:"",options:this.fb.array([])})}get options(){return this.fb.group({_id:"",value:""})}addQuestion(){this.SurveyForm.get("questions").push(this.questions)}removeQuestion(e){this.SurveyForm.get("questions").removeAt(e)}addOption(e){e.get("options").push(this.options)}removeOption(e,t){e.get("options").removeAt(t)}loadForm(e){this.SurveyForm.controls.survey_details.controls._id.patchValue(e._id),this.SurveyForm.controls.survey_details.controls.title.patchValue(e.title),this.SurveyForm.controls.survey_details.controls.description.patchValue(e.description);for(let t=0;t<e.questions.length;t++){const o=this.SurveyForm.get("questions");o.push(this.questions);for(let i=0;i<e.questions[t].options.length;i++)o.at(t).get("options").push(this.options)}this.SurveyForm.patchValue(e)}onSubmit(){return Object(u.a)(this,void 0,void 0,(function*(){let e=this.SurveyForm.value;if(console.log("form data",e),this.SurveyForm.get("questions").touched){console.log("toched");let t=e.questions;for(const[o,i]of t.entries()){let t=this.SurveyForm.get("questions"),n=t.at(o).get("options");if(t.at(o).touched){if(i.survey_id=e.survey_details._id,i._id){let e=i;this.dataService.updateQuestion(e).subscribe(),console.log("Update question",e)}else{let e=i;this.createdQuestion=yield this.dataService.createQuestion(e).toPromise(),console.log("Create new question this.createdQuestion",this.createdQuestion)}let t=i.options;for(const[e,o]of t.entries())n.at(e).touched&&(o.question_id=i._id,o._id?(this.dataService.updateOption(o).subscribe(),console.log("update new option",o)):(o.question_id=this.createdQuestion._id,this.dataService.createOption(o).subscribe(),console.log("Create new option",o)))}}}if(this.SurveyForm.get("survey_details").touched)if(e.survey_details._id){let t=e.survey_details;this.dataService.updateSurvey(t).subscribe(),console.log("Create new survey",t)}else{let t=e.survey_details;this.dataService.createSurvey(t).subscribe(),console.log("Create new survey",t)}}))}createSurvey(){console.log("this.newSurveyForm",this.newSurveyForm),this.dataService.createSurvey(this.newSurveyForm).subscribe(e=>{console.log("submitSurvey resp",e),this.surveyId=e._id,this.newSurveyForm={title:e.title,description:e.description}})}logout(){this.dataService.logout().subscribe(e=>{console.log("logged out",e)})}}return e.\u0275fac=function(t){return new(t||e)(c.Hb(a.a),c.Hb(s.g),c.Hb(n.c),c.Hb(s.a),c.Hb(r.H),c.Hb(r.x))},e.\u0275cmp=c.Bb({type:e,selectors:[["app-edit-survey"]],decls:42,vars:5,consts:[["slot","primary"],["src","../../assets/avatar.svg"],[3,"click"],["size","large","name","log-out-sharp"],[1,"ion-padding"],[1,"ion-margin","ion-padding"],[1,"ion-margin"],["size","12"],[1,"favCard-header"],[3,"formGroup","ngSubmit"],["formGroupName","survey_details",1,"form-header"],["type","text","formControlName","title","name","title"],["type","text","formControlName","description","name","description"],["size","large","name","add-circle-outline",1,"ion-padding"],["formArrayName","questions"],["class","questions",3,"formGroupName",4,"ngFor","ngForOf"],["color","primary","type","submit"],[1,"questions",3,"formGroupName"],["size","large","name","close-circle-outline"],["type","text","formControlName","name","name","title"],["formControlName","type","placeholder","Select One"],["value","dropdown"],["value","radio"],["formArrayName","options"],["class","options",3,"formGroupName",4,"ngFor","ngForOf"],[1,"options",3,"formGroupName"],["name","close-circle-outline"],["type","text","formControlName","value","name","value"]],template:function(e,t){1&e&&(c.Kb(0,"ion-header"),c.Kb(1,"ion-toolbar"),c.Kb(2,"ion-buttons",0),c.Kb(3,"ion-chip"),c.Kb(4,"ion-avatar"),c.Ib(5,"img",1),c.Jb(),c.Kb(6,"ion-label"),c.hc(7),c.Jb(),c.Jb(),c.Kb(8,"ion-button",2),c.Rb("click",(function(){return t.logout()})),c.Ib(9,"ion-icon",3),c.Jb(),c.Jb(),c.Kb(10,"ion-title"),c.hc(11,"Mswali Test Survey"),c.Jb(),c.Jb(),c.Jb(),c.Kb(12,"ion-content",4),c.Kb(13,"h1",5),c.hc(14,"Edit Survey"),c.Jb(),c.Kb(15,"ion-content",6),c.Kb(16,"ion-row"),c.Kb(17,"ion-col",7),c.Kb(18,"ion-card",4),c.Kb(19,"ion-card-header",8),c.Kb(20,"ion-card-title"),c.hc(21),c.Jb(),c.Kb(22,"ion-card-subtitle"),c.hc(23),c.Jb(),c.Jb(),c.Kb(24,"ion-card-content"),c.Kb(25,"form",9),c.Rb("ngSubmit",(function(){return t.onSubmit()})),c.Kb(26,"div",10),c.Kb(27,"ion-label"),c.hc(28,"Survey Title"),c.Jb(),c.Kb(29,"ion-item"),c.Ib(30,"ion-input",11),c.Jb(),c.Kb(31,"ion-label"),c.hc(32,"Description"),c.Jb(),c.Kb(33,"ion-item"),c.Ib(34,"textarea",12),c.Jb(),c.Jb(),c.Kb(35,"ion-button",2),c.Rb("click",(function(){return t.addQuestion()})),c.hc(36," Add Question "),c.Ib(37,"ion-icon",13),c.Jb(),c.Kb(38,"div",14),c.gc(39,l,24,2,"div",15),c.Jb(),c.Kb(40,"ion-button",16),c.hc(41,"Create"),c.Jb(),c.Jb(),c.Jb(),c.Jb(),c.Jb(),c.Jb(),c.Jb(),c.Jb()),2&e&&(c.xb(7),c.ic(t.username),c.xb(14),c.ic(null==t.survey?null:t.survey.description),c.xb(2),c.ic(null==t.survey?null:t.survey.description),c.xb(2),c.Yb("formGroup",t.SurveyForm),c.xb(14),c.Yb("ngForOf",t.SurveyForm.get("questions").controls))},directives:[r.o,r.D,r.e,r.k,r.c,r.s,r.d,r.p,r.C,r.m,r.y,r.l,r.f,r.h,r.j,r.i,r.g,n.q,n.k,n.e,n.f,r.r,r.q,r.N,n.j,n.d,n.a,n.b,i.i,r.z,r.M,r.A],styles:[".questions[_ngcontent-%COMP%]{padding:10px;margin:10px 0;border:1px solid #000}.closebutton[_ngcontent-%COMP%]{margin-top:1px;margin-right:2px;position:absolute;top:0;right:0}"]}),e})()}];let p=(()=>{class e{}return e.\u0275mod=c.Fb({type:e}),e.\u0275inj=c.Eb({factory:function(t){return new(t||e)},imports:[[s.k.forChild(d)],s.k]}),e})(),m=(()=>{class e{}return e.\u0275mod=c.Fb({type:e}),e.\u0275inj=c.Eb({factory:function(t){return new(t||e)},imports:[[i.b,n.g,n.n,r.E,p]]}),e})()}}]);